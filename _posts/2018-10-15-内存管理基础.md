---
layout: post
title:  "内存管理基础"
subtitle: ""
date:   2018-10-15 10:45:13 -0400
background: '/img/posts/08.jpg'
---
https://hit-alibaba.github.io/interview/basic/arch/Memory-Management.html

### 可执行文件在内存中的的结构

- 只读部分
  - .text - 程序代码
  - .rodata - 程序中的常量
- 可读写部分
  - .data - 初始化全局变量和静态变量
  - .bss -  Block Started by Symbol， 未初始化的全局变量和静态变量 
  - heap - 堆，使用 malloc, realloc, 和 free 函数控制的变量 
  - stack - 栈，函数调用时使用栈来保存函数现场 



-----------

- **.data 与 .bss**

```c
int val = 3;
char string[] = "Hello World";
```

起初这两个变量的值被写在代码中，因此程序运行时会被拷贝到 `.data`中，而不初始化（未定义初始值）的话，将会被存放在`.bss`中

```c
static int i;
```

--------------

- **静态变量 与 全局变量**
- `全局变量`：定义在函数外，这个变量将拥有全局作用域，成为全局变量。*这时这个变量不只可以在整个文件中使用，也可以在其他文件中使用*。举例如下：

```c
#include <stdio.h>

int a;

int compute(void);

int main()
{
    a = 1;
    printf("%d %d\n", a, compute());
    return 0;
}
```

file：1.c

```c
int a;

int compute(void)
{
    a = 0;
    return a;
}
```

file：2.c

在这两个文件中，a都被定义在函数外，均为全局变量，Linker会不知道应该使用哪一个而产生重复定义错误。

- `静态变量`：为避免全局变量引起重复定义错误而引入。用static关键词来修饰，对变量的作用域进行了限制，具体限制如下：
  - 在函数外定义：全局变量，但是只在当前文件中可见 
  - 在函数内定义：全局变量，但是只在此函数内可见 
  - 在类中定义：全局变量，但是只在此类中可见 

- `extern`：指示变量或函数的定义在别的文件中。常见用法：

  ```c
  static int m;
  extern int m;
  ```

  

### 栈

> 用于存放本地变量，内部临时变量，有关上下文的内存区域。

因为有了栈，程序在调用函数时，操作系统会自动通过压栈和弹栈完成保存函数现场等操作，而不需要程序员手动干预。 

栈是一块连续的内存区域，栈顶的地址和栈的最大容量是系统预先规定好的。能从栈获得的空间较小。 

`stackoverflow`：申请的空间超过栈的剩余空间时，例如递归深度过深时，将引发该错误。

栈是由机器系统提供的数据结构，得到计算机底层的支持，如：

 - 分配专门的寄存器存放栈的地址 
 - 压栈出栈都有专门的指令执行 



### 堆

